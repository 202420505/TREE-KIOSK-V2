<!doctype html>
<html lang="kr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TREE KIOSK SYSTEM V2</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
<link rel="stylesheet" type="text/css" href="login.css"> 

</head>

<body>
<div class="container">
    <center>
    <div id="front" style="display:none">

        <!-- Make the text clickable to log out -->
        <a href="#" id="logout-link" class="text-decoration-none">
            <p class="text-center fs-1 fw-bold">TREE KIOSK</p>
        </a>
        <div id="loading" style="display: none;"> ...</div>
        <button type="button" id="front-start" onclick="location.href='main.html'" class="btn btn-outline-primary">시작하기</button>
 
    </div>
    
    <div id="login-container" class="login-container" style="display:none">
        <button id="googleLoginBtn" class="login-btn google-btn">Login with Google</button>
        <button id="githubLoginBtn" class="login-btn github-btn">Login with GitHub</button>
    </div>
</center>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script type="module">
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDruA1fSmRQqM-xDgJhgu9KKVGWj8GpuKQ",
        authDomain: "tree-kiosk-system-v2.firebaseapp.com",
        databaseURL: "https://tree-kiosk-system-v2-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "tree-kiosk-system-v2",
        storageBucket: "tree-kiosk-system-v2.appspot.com",
        messagingSenderId: "719927565453",
        appId: "1:719927565453:web:caa088914a03dcb2e896c4"
    };
    
    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Google Sign-In
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    document.getElementById('googleLoginBtn').addEventListener('click', async () => {
        try {
            const result = await auth.signInWithPopup(googleProvider);
            console.log('User is signed in:', result.user.email);
            location.href = 'main.html';
        } catch (error) {
            console.error('Error during Google sign-in:', error);
        }
    });

    // GitHub Sign-In
    const githubProvider = new firebase.auth.GithubAuthProvider();
    document.getElementById('githubLoginBtn').addEventListener('click', async () => {
        try {
            const result = await auth.signInWithPopup(githubProvider);
            console.log('User is signed in:', result.user.email);
            location.href = 'main.html';
        } catch (error) {
            console.error('Error during GitHub sign-in:', error);
        }
    });

    // Monitor Auth State
    auth.onAuthStateChanged(user => {
        if (user) {
            console.log('User is signed in:', user.email);
            localStorage.setItem('user', user.email);
            show('front', 'login-container');
        } else {
            show('login-container', 'front');
        }
    });

    // Click counter and logout function
    let clickCount = 0;
    document.getElementById('logout-link').addEventListener('click', async (e) => {
        e.preventDefault(); // Prevent the default link behavior
        clickCount++; // Increment click count

        if (clickCount === 5) { // Check if clicked 5 times
            try {
                await auth.signOut();
                console.log('User signed out after 5 clicks');
                show('login-container', 'front'); // Show the login container after sign out
                clickCount = 0; // Reset click count after logout
            } catch (error) {
                console.error('Error during sign out:', error);
            }
        }
    });

    function show(shown, hidden) {
        document.getElementById(shown).style.display = 'block';
        document.getElementById(hidden).style.display = 'none';
    }
</script>
</body>
</html>
